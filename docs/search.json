[
  {
    "objectID": "posts/Opening-Apple-Health-data/index.html#opening-apple-health-data",
    "href": "posts/Opening-Apple-Health-data/index.html#opening-apple-health-data",
    "title": "Opening Apple Health data",
    "section": "Opening Apple Health data",
    "text": "Opening Apple Health data\nMy partner exported her Apple Health data using the Health app’s export functionality. We now have a folder of .xml files to deal with.\nLet’s take a look at export.xml which I think should contain the sleep data.\nReading the first few characters of the file\n\nlibrary('readr')\nhealth_filepath &lt;- '../../data/apple_health_export/export.xml'\nhealth_file &lt;- substr(read_file(health_filepath), 1, 2000)\nprint(health_file)\n\n[1] \"&lt;?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?&gt;\\n&lt;!DOCTYPE HealthData [\\n&lt;!-- HealthKit Export Version: 13 --&gt;\\n&lt;!ELEMENT HealthData (ExportDate,Me,(Record|Correlation|Workout|ActivitySummary|ClinicalRecord|Audiogram|VisionPrescription)*)&gt;\\n&lt;!ATTLIST HealthData\\n  locale CDATA #REQUIRED\\n&gt;\\n&lt;!ELEMENT ExportDate EMPTY&gt;\\n&lt;!ATTLIST ExportDate\\n  value CDATA #REQUIRED\\n&gt;\\n&lt;!ELEMENT Me EMPTY&gt;\\n&lt;!ATTLIST Me\\n  HKCharacteristicTypeIdentifierDateOfBirth                   CDATA #REQUIRED\\n  HKCharacteristicTypeIdentifierBiologicalSex                 CDATA #REQUIRED\\n  HKCharacteristicTypeIdentifierBloodType                     CDATA #REQUIRED\\n  HKCharacteristicTypeIdentifierFitzpatrickSkinType           CDATA #REQUIRED\\n  HKCharacteristicTypeIdentifierCardioFitnessMedicationsUse   CDATA #REQUIRED\\n&gt;\\n&lt;!ELEMENT Record ((MetadataEntry|HeartRateVariabilityMetadataList)*)&gt;\\n&lt;!ATTLIST Record\\n  type          CDATA #REQUIRED\\n  unit          CDATA #IMPLIED\\n  value         CDATA #IMPLIED\\n  sourceName    CDATA #REQUIRED\\n  sourceVersion CDATA #IMPLIED\\n  device        CDATA #IMPLIED\\n  creationDate  CDATA #IMPLIED\\n  startDate     CDATA #REQUIRED\\n  endDate       CDATA #REQUIRED\\n&gt;\\n&lt;!-- Note: Any Records that appear as children of a correlation also appear as top-level records in this document. --&gt;\\n&lt;!ELEMENT Correlation ((MetadataEntry|Record)*)&gt;\\n&lt;!ATTLIST Correlation\\n  type          CDATA #REQUIRED\\n  sourceName    CDATA #REQUIRED\\n  sourceVersion CDATA #IMPLIED\\n  device        CDATA #IMPLIED\\n  creationDate  CDATA #IMPLIED\\n  startDate     CDATA #REQUIRED\\n  endDate       CDATA #REQUIRED\\n&gt;\\n&lt;!ELEMENT Workout ((MetadataEntry|WorkoutEvent|WorkoutRoute|WorkoutStatistics)*)&gt;\\n&lt;!ATTLIST Workout\\n  workoutActivityType   CDATA #REQUIRED\\n  duration              CDATA #IMPLIED\\n  durationUnit          CDATA #IMPLIED\\n  totalDistance         CDATA #IMPLIED\\n  totalDistanceUnit     CDATA #IMPLIED\\n  totalEnergyBurned     CDATA #IMPLIED\\n  totalEnergyBurnedUnit CDATA #IMPLIED\\n  sourceName            CDATA #REQUIRED\\n  sourceVersion         C\"\n\n\nSo it looks like Apple use HKCharacteristicTypeIdentifier as a prefix to some data. Perhaps this is just a field name?\nLet’s parse the xml file properly and see what we have\n\n# install.packages(\"XML\") # I need this one to work with the xml files\nlibrary(\"XML\")\n\n# here are some ones that I think I might need\nlibrary(\"methods\")\nlibrary(\"tidyverse\")\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3     ✔ purrr     1.0.2\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(\"lubridate\")\nlibrary(\"ggplot2\")\nlibrary(\"dplyr\")\n\n# parse the xml file\nhealth &lt;- xmlParse(health_filepath)\nsummary(health)\n\n$nameCounts\n\n                          Record      InstantaneousBeatsPerMinute \n                          505685                           171703 \n                   MetadataEntry HeartRateVariabilityMetadataList \n                          144203                             2511 \n                 ActivitySummary                     WorkoutEvent \n                             410                              172 \n               WorkoutStatistics                          Workout \n                             143                               38 \n                   FileReference                     WorkoutRoute \n                              30                               30 \n                      ExportDate                       HealthData \n                               1                                1 \n                              Me \n                               1 \n\n$numNodes\n[1] 824928\n\n\nHmm, not very helpful?\nInstead of spending more time trying to parse the xml file myself, let’s turn to Google. This site seems to have some explanations of what’s going on with the Apple Watch data. It looks like indeed HKQuantityTypeIdentifier is just a prefix for a field name. There should be a field called HKCategoryTypeIdentifierSleepAnalysis which sounds like what I am after!"
  },
  {
    "objectID": "posts/Opening-Apple-Health-data/index.html#exploring-the-data",
    "href": "posts/Opening-Apple-Health-data/index.html#exploring-the-data",
    "title": "Opening Apple Health data",
    "section": "Exploring the data",
    "text": "Exploring the data\nThis blog gives a snippet that should convert the entire xml import into a dataframe. This has saved a ton of time!\n\n# https://www.johngoldin.com/blog/apple-health-export/2022-07-notes-apple-health-export/index.html\nhealth_df &lt;- XML:::xmlAttrsToDataFrame(health[\"//Record\"], stringsAsFactors = FALSE) |&gt;\n        as_tibble() |&gt; mutate(value = as.numeric(value)) |&gt;\n        select(-device)  \n\nWarning: There was 1 warning in `mutate()`.\nℹ In argument: `value = as.numeric(value)`.\nCaused by warning:\n! NAs introduced by coercion\n\nsummary(health_df)\n\n     type            sourceName        sourceVersion          unit          \n Length:505685      Length:505685      Length:505685      Length:505685     \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n                                                                            \n creationDate        startDate           endDate              value         \n Length:505685      Length:505685      Length:505685      Min.   :   0.000  \n Class :character   Class :character   Class :character   1st Qu.:   0.365  \n Mode  :character   Mode  :character   Mode  :character   Median :   1.266  \n                                                          Mean   :  27.002  \n                                                          3rd Qu.:  35.696  \n                                                          Max.   :1290.000  \n                                                          NA's   :17576     \n\n\n\nglimpse(health_df)\n\nRows: 505,685\nColumns: 8\n$ type          &lt;chr&gt; \"HKQuantityTypeIdentifierHeight\", \"HKQuantityTypeIdentif…\n$ sourceName    &lt;chr&gt; \"Health\", \"Health\", \"Matthew’s Apple Watch\", \"Matthew’s …\n$ sourceVersion &lt;chr&gt; \"15.6.1\", \"15.6.1\", \"9.3.1\", \"9.3.1\", \"9.3.1\", \"9.3.1\", …\n$ unit          &lt;chr&gt; \"ft\", \"kg\", \"count/min\", \"count/min\", \"count/min\", \"coun…\n$ creationDate  &lt;chr&gt; \"2022-08-22 21:27:24 +0100\", \"2022-08-22 21:27:24 +0100\"…\n$ startDate     &lt;chr&gt; \"2022-08-22 21:27:24 +0100\", \"2022-08-22 21:27:24 +0100\"…\n$ endDate       &lt;chr&gt; \"2022-08-22 21:27:24 +0100\", \"2022-08-22 21:27:24 +0100\"…\n$ value         &lt;dbl&gt; 6.33333, 114.50000, 93.00000, 91.00000, 96.00000, 92.000…\n\n\nOkay so we have half a million rows and eight columns. We’ve already cast our values to numeric, which is great. Looks like we have some metadata (sourceName, sourceVersion) about how the data was collected. I should take a quick glance at these fields but I can probably ignore them.\nThe type field looks to contain my different health data, so I’ll want to filter by that. unit is probably nothing I need to think about, but once I’ve found my sleep data I should just check that I can safely ignore the field.\nThen we have creationDate, startDate and endDate. I will need to cast these to datetimes (& work out how to work with datetimes in R!) and then work out how they relate to the value field for the sleep data that I am interested in. I assume that the relationship between the datetime fields and value will differ depending on type so there’s not going to be a one-size-fits-all approach here.\nLet’s look at the most frequent type’s"
  },
  {
    "objectID": "posts/welcome/index.html",
    "href": "posts/welcome/index.html",
    "title": "Welcome To My Blog",
    "section": "",
    "text": "This is the first post in a Quarto blog. Welcome!\n\nSince this post doesn’t specify an explicit image, the first image in the post will be used in the listing page of posts."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Does a late nap mean a worse night’s sleep?",
    "section": "",
    "text": "Opening Apple Health data\n\n\n\n\n\n\n\napple\n\n\ncode\n\n\nimport\n\n\nxml\n\n\nR\n\n\n\n\n\n\n\n\n\n\n\nOct 26, 2023\n\n\nMatt Thornton\n\n\n\n\n\n\n  \n\n\n\n\nWelcome To My Blog\n\n\n\n\n\n\n\nnews\n\n\nbaby\n\n\n\n\n\n\n\n\n\n\n\nOct 25, 2023\n\n\nMatt Thornton\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About Matt’s Baby Stats",
    "section": "",
    "text": "About this blog"
  }
]